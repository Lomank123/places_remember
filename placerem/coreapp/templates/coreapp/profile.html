{% extends 'layout/basic.html' %}
{% load thumbnail %}
{% load static %}
{% load socialaccount %}

{% block title %}Profile{% endblock title %}

{% block content %}

  <h2>Your profile</h2>
  <hr />

  <!-- Main info about user -->
  <div class="profile-info-main profile-block">
    <img
      class="img-default profile-image"
      src="{{ object.photo|thumbnail_url:'default' }}"
      onerror="this.onerror=null;this.src='{% static 'placerem/images/empty.jpg' %}';" />

    <div class="profile-name-email">
      <span class="profile-info">Name: {{ object.username }}</span>
      <hr />
      <span class="profile-info">Email: {{ object.email }}</span>
    </div>
  </div>

  <h2>Additional info</h2>
  <hr />

  <!-- Some additional info about user -->
  <div class="profile-info-additional profile-block">
    <span class="profile-info">Number of recollections: {{ recollections }}</span>
    <hr />
    <span class="profile-info">Account creation date: {{ object.date_joined }}</span>
  </div>

  <h2>
    <span>Social</span>
    <span class="manage-link"><a href="{% url 'socialaccount_connections' %}">Manage</a></span>
  </h2>
  <hr />
  <!-- Info about authentication (what providers user is using) -->
  <div class="profile-info-additional profile-block">
    {% for provider_name, provider_info in allauth_accounts %}
      <div class="profile-info profile-auth">
        <span class="span-provider">{{ provider_name }}</span>
        {% if provider_info.exists %}
          <span class="span-link span-linked">Linked!</span>
        {% else %}
          <span class="span-link">
            <a href="{% provider_login_url provider_info.provider_id process="connect" method="oauth2" next=request.path %}">Link</a>
          </span>
        {% endif %}
      </div>
    {% endfor %}
    <!-- This section will display any messages connected with allauth (errors and etc.) -->
    {% if messages %}
      <div class="err-messages">
        <hr />
        <strong>Error:</strong>
        <ul class="msg-list">
          {% for message in messages %}
          <li class="new-msg">{{message}}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>

  <button class="btn btn-primary" id="edit_prof_btn" type="button">Edit profile</button>
  <button class="btn btn-primary" id="edit_pass_btn" type="button">Change password</button>
  <script>
    var prof_btn = document.getElementById("edit_prof_btn");
    var pass_btn = document.getElementById("edit_pass_btn");

    prof_btn.onclick = function() {
      window.location.href = "{% url 'profile_edit' pk=object.pk %}";
    }
    pass_btn.onclick = function() {
      window.location.href = "{% url 'change_password' %}";
    }
  </script>

{% endblock %}